{% extends "base.html" %} {% block title %}Pharmacy Inventory - Allo Health{%
endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
/>
{% endblock %} {% block content %}
<div
  class="page-header"
  style="
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  "
>
  <div>
    <h1 class="page-title"><i class="fas fa-pills"></i> Medicine Inventory</h1>
    <p class="page-subtitle">Manage medicine stock and expiry dates</p>
  </div>
  <a href="{{ url_for('add_medicine') }}" class="btn btn-primary"
    ><i class="fas fa-plus"></i> Add Medicine</a
  >
</div>

<!-- Alerts -->
<div style="margin-bottom: 2rem">
  {% if expired %}
  <div class="alert alert-danger" style="margin-bottom: 1rem">
    <i class="fas fa-exclamation-circle"></i>
    <strong>{{ expired|length }} Expired Medicine(s)</strong> - Please remove
    from stock immediately
  </div>
  {% endif %} {% if expiring_soon %}
  <div class="alert alert-warning" style="margin-bottom: 1rem">
    <i class="fas fa-clock"></i>
    <strong>{{ expiring_soon|length }} Medicines Expiring Soon</strong> - Review
    expiry dates
  </div>
  {% endif %} {% if low_stock %}
  <div class="alert alert-info" style="margin-bottom: 1rem">
    <i class="fas fa-info-circle"></i>
    <strong>{{ low_stock|length }} Low Stock Item(s)</strong> - Consider
    reordering
  </div>
  {% endif %}
</div>

<!-- Statistics -->
<div class="grid grid-cols-4" style="margin-bottom: 2rem">
  <div class="stat-card">
    <div class="stat-card-header">
      <div>
        <div class="stat-value">{{ inventory|length }}</div>
        <div class="stat-label">Total Medicines</div>
      </div>
      <div class="stat-icon">
        <i class="fas fa-pills" style="color: var(--primary-purple)"></i>
      </div>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-card-header">
      <div>
        <div class="stat-value">{{ low_stock|length }}</div>
        <div class="stat-label">Low Stock</div>
      </div>
      <div class="stat-icon">
        <i
          class="fas fa-exclamation-triangle"
          style="color: var(--primary-purple)"
        ></i>
      </div>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-card-header">
      <div>
        <div class="stat-value">{{ expiring_soon|length }}</div>
        <div class="stat-label">Expiring Soon</div>
      </div>
      <div class="stat-icon">
        <i
          class="fas fa-calendar-times"
          style="color: var(--primary-purple)"
        ></i>
      </div>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-card-header">
      <div>
        <div class="stat-value">{{ expired|length }}</div>
        <div class="stat-label">Expired</div>
      </div>
      <div class="stat-icon">
        <i class="fas fa-ban" style="color: var(--primary-purple)"></i>
      </div>
    </div>
  </div>
</div>

<!-- Inventory Table -->
<div class="card">
  {% if inventory %}
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th><i class="fas fa-pill"></i> Medicine Name</th>
          <th><i class="fas fa-box"></i> Current Stock</th>
          <th><i class="fas fa-exclamation"></i> Min Level</th>
          <th><i class="fas fa-dollar-sign"></i> Unit Price</th>
          <th><i class="fas fa-calendar-alt"></i> Expiry Date</th>
          <th><i class="fas fa-info-circle"></i> Status</th>
          <th><i class="fas fa-cogs"></i> Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for medicine in inventory %}
        <tr>
          <td><strong>{{ medicine.medicine_name }}</strong></td>
          <td>
            <strong>{{ medicine.current_stock }}</strong>
            {% if medicine.is_low_stock() %}
            <br /><small style="color: var(--warning)"
              ><i class="fas fa-warning"></i> Low Stock</small
            >
            {% endif %}
          </td>
          <td>{{ medicine.min_stock_level }}</td>
          <td>â‚¹ {{ "%.2f"|format(medicine.unit_price) }}</td>
          <td>
            {% if medicine.expiry_date %} {{ medicine.expiry_date.strftime('%b
            %d, %Y') }} {% else %}
            <small style="color: var(--text-gray)">No expiry</small>
            {% endif %}
          </td>
          <td>
            {% if medicine.is_expired() %}
            <span class="badge badge-danger"
              ><i class="fas fa-ban"></i> Expired</span
            >
            {% elif medicine.days_to_expiry() and medicine.days_to_expiry() <=
            30 %}
            <span class="badge badge-warning"
              ><i class="fas fa-clock"></i> Expires in {{
              medicine.days_to_expiry() }} days</span
            >
            {% elif medicine.is_low_stock() %}
            <span class="badge badge-warning"
              ><i class="fas fa-exclamation-triangle"></i> Low Stock</span
            >
            {% else %}
            <span class="badge badge-success"
              ><i class="fas fa-check-circle"></i> Good</span
            >
            {% endif %}
          </td>
          <td>
            <a
              href="{{ url_for('edit_medicine', id=medicine.id) }}"
              class="btn btn-sm btn-secondary"
            >
              <i class="fas fa-edit"></i> Edit
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div style="text-align: center; padding: 3rem; color: var(--text-gray)">
    <i
      class="fas fa-inbox"
      style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5"
    ></i>
    <p><strong>No medicines in inventory.</strong></p>
    <a
      href="{{ url_for('add_medicine') }}"
      class="btn btn-primary"
      style="margin-top: 1rem"
    >
      <i class="fas fa-plus"></i> Add First Medicine
    </a>
  </div>
  {% endif %}
</div>
{% endblock %}
