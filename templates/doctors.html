{% extends "base.html" %}

{% block title %}Doctors - Allo Health{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}
<div class="page-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
  <div>
    <h1 class="page-title"><i class="fas fa-user-md"></i> Doctors</h1>
    <p class="page-subtitle">Manage medical staff</p>
  </div>
  {% if current_user.role == 'admin' %}
    <a href="{{ url_for('doctor_new') }}" class="btn btn-primary"><i class="fas fa-user-plus"></i> Add Doctor</a>
  {% endif %}
</div>

<!-- Filters -->
<div class="card" style="margin-bottom: 2rem;">
  <form method="GET" style="display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); align-items: end;">
    <div>
      <label class="form-label"><i class="fas fa-search"></i> Search</label>
      <input 
        type="text" 
        name="search" 
        class="form-control" 
        placeholder="Search by name..." 
        value="{{ search }}"
      >
    </div>
    <div>
      <label class="form-label"><i class="fas fa-stethoscope"></i> Specialization</label>
      <select name="specialization" class="form-control">
        <option value="">All Specializations</option>
        {% for spec in specializations %}
          <option value="{{ spec }}" {% if selected_spec == spec %}selected{% endif %}>{{ spec }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <button type="submit" class="btn btn-primary"><i class="fas fa-filter"></i> Filter</button>
    </div>
    {% if search or selected_spec %}
      <div>
        <a href="{{ url_for('doctors') }}" class="btn btn-secondary"><i class="fas fa-times"></i> Clear</a>
      </div>
    {% endif %}
  </form>
</div>

<!-- Doctors Grid -->
<div class="grid grid-cols-3">
  {% for doctor in doctors %}
  <div class="card">
    <div class="card-header" style="margin-bottom: 1rem; padding-bottom: 0.75rem;">
      <div>
        <h3 class="card-title" style="font-size: 1.15rem; margin-bottom: 0.25rem;"><i class="fas fa-user-tie"></i> Dr. {{ doctor.user.full_name }}</h3>
        <p style="color: var(--text-gray); font-size: 0.9rem;"><i class="fas fa-briefcase"></i> {{ doctor.specialization }}</p>
      </div>
    </div>
    <div class="card-body">
      <div style="display: grid; gap: 0.75rem; font-size: 0.95rem;">
        {% if doctor.phone %}
        <div>
          <p style="color: var(--text-gray); font-size: 0.85rem;"><i class="fas fa-phone"></i> Phone</p>
          <p>{{ doctor.phone }}</p>
        </div>
        {% endif %}
        {% if doctor.location %}
        <div>
          <p style="color: var(--text-gray); font-size: 0.85rem;"><i class="fas fa-map-marker-alt"></i> Location</p>
          <p>{{ doctor.location }}</p>
        </div>
        {% endif %}
        {% if doctor.consultation_fee %}
        <div>
          <p style="color: var(--text-gray); font-size: 0.85rem;"><i class="fas fa-rupee-sign"></i> Consultation Fee</p>
          <p>â‚¹{{ doctor.consultation_fee }}</p>
        </div>
        {% endif %}
        <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border-gray);">
          <span class="badge {% if doctor.is_active %}badge-success{% else %}badge-danger{% endif %}">
            {% if doctor.is_active %}<i class="fas fa-check-circle"></i> Active{% else %}<i class="fas fa-ban"></i> Inactive{% endif %}
          </span>
        </div>
      </div>
      {% if current_user.role == 'admin' %}
      <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
        <a href="{{ url_for('doctor_edit', id=doctor.id) }}" class="btn btn-sm btn-secondary" style="flex: 1; text-align: center;"><i class="fas fa-edit"></i> Edit</a>
        <form method="POST" action="{{ url_for('doctor_toggle_active', id=doctor.id) }}" style="flex: 1;">
          <button type="submit" class="btn btn-sm {% if doctor.is_active %}btn-warning{% else %}btn-success{% endif %}" style="width: 100%;">
            {% if doctor.is_active %}<i class="fas fa-ban"></i> Deactivate{% else %}<i class="fas fa-check"></i> Activate{% endif %}
          </button>
        </form>
      </div>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>

{% if not doctors %}
<div class="card" style="text-align: center; padding: 3rem;">
  <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
  <p style="color: var(--text-gray); font-size: 1.1rem;">No doctors found.</p>
</div>
{% endif %}
{% endblock %}
