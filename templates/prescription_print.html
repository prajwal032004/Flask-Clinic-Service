{% extends "base.html" %} {% block title %}Prescription Receipt - Allo Health{%
endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
/>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html,
  body {
    height: 100%;
    background: #f5f5f5;
    font-family: Arial, sans-serif;
  }

  @media print {
    body,
    html {
      background: white;
      margin: 0;
      padding: 0;
      height: auto;
    }
    .navbar,
    footer,
    .print-btn {
      display: none !important;
    }
    .prescription-wrapper {
      max-width: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      border: none;
      box-shadow: none;
      page-break-after: always;
    }
    @page {
      size: A4;
      margin: 0;
    }
  }

  body {
    padding: 20px;
  }

  .prescription-wrapper {
    max-width: 750px;
    margin: 0 auto;
    background: white;
    padding: 40px;
    border: 1px solid #ddd;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  .header {
    text-align: center;
    border-bottom: 3px solid #433393;
    padding-bottom: 20px;
    margin-bottom: 25px;
  }

  .header-logo {
    font-size: 32px;
    color: #433393;
    margin-bottom: 8px;
  }

  .hospital-name {
    font-size: 22px;
    font-weight: bold;
    color: #433393;
    margin: 0;
  }

  .hospital-desc {
    font-size: 12px;
    color: #666;
    margin: 5px 0 0 0;
  }

  .top-info {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 25px;
  }

  .info-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px dashed #999;
  }

  .info-label {
    font-weight: bold;
    color: #433393;
    font-size: 12px;
  }

  .info-value {
    color: #333;
    font-size: 12px;
    text-align: right;
  }

  .title {
    text-align: center;
    color: #433393;
    font-size: 20px;
    font-weight: bold;
    margin: 25px 0;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .patient-details {
    margin-bottom: 25px;
  }

  .detail-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 15px;
  }

  .detail-item {
    padding: 10px 0;
    border-bottom: 1px dashed #999;
  }

  .detail-label {
    font-weight: bold;
    color: #433393;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .detail-value {
    color: #333;
    font-size: 13px;
    margin-top: 5px;
  }

  .full-width {
    grid-column: 1 / -1;
  }

  .medications-section {
    margin: 30px 0;
    border-top: 1px dashed #999;
    padding-top: 20px;
  }

  .section-title {
    font-weight: bold;
    color: #433393;
    font-size: 13px;
    text-transform: uppercase;
    margin-bottom: 15px;
    border-bottom: 2px solid #433393;
    padding-bottom: 8px;
    letter-spacing: 0.5px;
  }

  .med-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
    margin-bottom: 20px;
  }

  .med-table th {
    background: #f0f0f0;
    border: 1px solid #999;
    padding: 10px;
    text-align: left;
    font-weight: bold;
    color: #433393;
  }

  .med-table td {
    border: 1px solid #999;
    padding: 10px;
    color: #333;
    line-height: 1.5;
  }

  .instructions-box {
    background: #f9f3ff;
    border-left: 5px solid #433393;
    padding: 15px;
    margin: 20px 0;
    font-size: 12px;
    color: #333;
  }

  .instructions-box strong {
    color: #433393;
    display: block;
    margin-bottom: 10px;
    font-size: 12px;
  }

  .instructions-box ul {
    margin-left: 20px;
    padding: 0;
    line-height: 1.8;
  }

  .instructions-box li {
    margin-bottom: 5px;
  }

  .status-section {
    margin: 25px 0;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    border-top: 1px dashed #999;
    padding-top: 15px;
  }

  .status-item {
    padding: 10px;
    border: 1px dashed #ccc;
    border-radius: 4px;
  }

  .status-label {
    font-weight: bold;
    color: #433393;
    font-size: 11px;
    text-transform: uppercase;
  }

  .status-value {
    color: #333;
    font-size: 12px;
    margin-top: 8px;
  }

  .status-badge {
    display: inline-block;
    background: #e8f5f7;
    color: #409ba6;
    padding: 5px 10px;
    border-radius: 3px;
    font-size: 11px;
    font-weight: bold;
  }

  .signature-section {
    margin-top: 40px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    text-align: center;
  }

  .signature-box {
    border-top: 2px solid #333;
    margin-top: 50px;
    padding-top: 8px;
    font-size: 11px;
    font-weight: bold;
    color: #333;
  }

  .signature-box .label {
    font-weight: normal;
    font-size: 10px;
    margin-bottom: 20px;
    display: block;
  }

  .footer {
    text-align: center;
    margin-top: 35px;
    padding-top: 15px;
    border-top: 1px dashed #999;
    font-size: 10px;
    color: #666;
    line-height: 1.8;
  }

  .footer-note {
    color: #433393;
    font-weight: bold;
    margin-top: 10px;
  }

  .print-btn {
    text-align: center;
    margin-top: 30px;
    padding-top: 20px;
  }

  .btn {
    background: #433393;
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    font-size: 13px;
    margin: 0 5px;
    transition: all 0.3s;
  }

  .btn:hover {
    background: #2d2366;
  }

  .btn-secondary {
    background: #ddd;
    color: #333;
  }

  .btn-secondary:hover {
    background: #ccc;
  }

  @media (max-width: 768px) {
    .prescription-wrapper {
      padding: 20px;
      max-width: 100%;
    }
    .top-info,
    .detail-row,
    .status-section,
    .signature-section {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    .hospital-name {
      font-size: 18px;
    }
    .title {
      font-size: 16px;
    }
    .med-table {
      font-size: 11px;
    }
    .med-table th,
    .med-table td {
      padding: 8px;
    }
  }
</style>
{% endblock %} {% block content %}
<div class="prescription-wrapper">
  <!-- Header -->
  <div class="header">
    <div class="header-logo">
      <i class="fas fa-hospital"></i>
    </div>
    <h2 class="hospital-name">Allo Health</h2>
    <p class="hospital-desc">Hospital Management System</p>
  </div>

  <!-- Top Info -->
  <div class="top-info">
    <div>
      <div class="info-item">
        <span class="info-label">Rx ID:</span>
        <span class="info-value">#{{ prescription.id }}</span>
      </div>
    </div>
    <div>
      <div class="info-item">
        <span class="info-label">Date:</span>
        <span class="info-value"
          >{{ prescription.created_at.strftime('%d %b %Y') }}</span
        >
      </div>
      <div class="info-item">
        <span class="info-label">Time:</span>
        <span class="info-value"
          >{{ prescription.created_at.strftime('%I:%M %p') }}</span
        >
      </div>
    </div>
  </div>

  <!-- Title -->
  <div class="title">Prescription Receipt</div>

  <!-- Patient Details -->
  <div class="patient-details">
    <div class="detail-row">
      <div class="detail-item">
        <div class="detail-label">Patient Name</div>
        <div class="detail-value">{{ prescription.get_patient_name() }}</div>
      </div>
      <div class="detail-item">
        <div class="detail-label">Phone Number</div>
        <div class="detail-value">{{ prescription.get_patient_phone() }}</div>
      </div>
    </div>

    <div class="detail-row">
      <div class="detail-item">
        <div class="detail-label">Patient Type</div>
        <div class="detail-value">
          {% if prescription.patient %}Registered Patient{% else %}Walk-in
          Patient{% endif %}
        </div>
      </div>
      <div class="detail-item">
        <div class="detail-label">Age</div>
        <div class="detail-value">
          {% if prescription.patient and prescription.patient.age %}{{
          prescription.patient.age }} Years{% else %}N/A{% endif %}
        </div>
      </div>
    </div>

    <div class="detail-row full-width">
      <div class="detail-item full-width">
        <div class="detail-label">Doctor Name</div>
        <div class="detail-value">
          Dr. {{ prescription.doctor.user.full_name }} ({{
          prescription.doctor.specialization }})
        </div>
      </div>
    </div>
  </div>

  <!-- Medications -->
  <div class="medications-section">
    <div class="section-title">Prescribed Medications</div>

    <table class="med-table">
      <thead>
        <tr>
          <th style="width: 45%">Medicine</th>
          <th style="width: 55%">Instructions</th>
        </tr>
      </thead>
      <tbody>
        {% set meds = prescription.medication_details.split('\n') %} {% for med
        in meds %} {% if med.strip() %} {% set parts = med.split('-') %}
        <tr>
          <td>{{ parts[0].strip() if parts|length > 0 else med }}</td>
          <td>
            {{ parts[1].strip() if parts|length > 1 else 'As prescribed' }}
          </td>
        </tr>
        {% endif %} {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Instructions -->
  <div class="instructions-box">
    <strong
      ><i class="fas fa-info-circle"></i> Important Patient Instructions</strong
    >
    <ul>
      <li>Take medications exactly as prescribed by the doctor</li>
      <li>Do not skip doses without consulting the doctor</li>
      <li>Store medications in a cool, dry place away from children</li>
      <li>Report any side effects to your doctor immediately</li>
      <li>Complete the full course of medication</li>
      <li>Keep this receipt for your records</li>
    </ul>
  </div>

  <!-- Status -->
  <div class="status-section">
    <div class="status-item">
      <div class="status-label">Status</div>
      <div class="status-value">
        <span class="status-badge">
          {% if prescription.status == 'Dispensed' %} ✓ Dispensed {% else %} ⏱
          Pending Dispensing {% endif %}
        </span>
      </div>
    </div>
    <div class="status-item">
      <div class="status-label">Issued Date & Time</div>
      <div class="status-value">
        {{ prescription.created_at.strftime('%d %b %Y, %I:%M %p') }}
      </div>
    </div>
  </div>

  <!-- Signature -->
  <div class="signature-section">
    <div class="signature-box">
      <span class="label">Doctor Signature</span>
      <div style="margin-top: 25px">
        Dr. {{ prescription.doctor.user.full_name }}
      </div>
    </div>
    <div class="signature-box">
      <span class="label">Pharmacist Signature</span>
      <div style="margin-top: 25px">Pharmacist Seal</div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>
      <strong><i class="fas fa-lock"></i> Official Prescription Receipt</strong>
    </p>
    <p class="footer-note">Prescription ID: #{{ prescription.id }}</p>
    <p>
      Generated: {{ prescription.created_at.strftime('%d %B %Y at %H:%M:%S') }}
    </p>
    <p style="margin-top: 10px; font-style: italic">
      Keep this receipt for your medical records
    </p>
  </div>

  <!-- Print Buttons -->
  <div class="print-btn">
    <button class="btn" onclick="window.print()">
      <i class="fas fa-print"></i> Print Receipt
    </button>
    <a href="{{ url_for('pharmacy') }}" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i> Back to Pharmacy
    </a>
  </div>
</div>
{% endblock %}
